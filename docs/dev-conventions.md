# Convention для разработчиков

## Запуск приложения

Приложение запускается через docker. Поэтому перед запуском стоит убедиться, что docker-daemon включен. В случае, если он не включен, необходимо его запустить.

Есть 2 варианта запуска приложения через docker

1. *Запуск приложения целиком в докере*. 
    1. Собрать проект `./mvnw clean package` из корневой директории
    2. В терминале ввести команду `docker-compose up -d`. В этом случае после внесения изменений в проект, его необходимо пересобрать и перезапустить контейнер заново. Для этого можно использовать скрипт `./scripts/rebuild-and-rerun-app-container.sh`. Если контейнер был запущен, он будет пересоздан с новым имэйджем

2. *Запуск базы данных в докере, а сервиса без докера (гибридный подход)*. Данный подход позволяет запускать java программу напрямую из среды разработки, без пересборки docker-образа. Для данного подхода используется следующая последовательность шагов:
    1. В корневой директории проекта в терминале ввести `docker-compose up -d db` - запуск только БД в докере
    2. Подождать несколько секунд, пока БД запустится (чтобы убедиться в том, что БД поднялась можно использовать команду `docker logs chatroom_db_1`)
    3. Запустить java сервис напрямую из среды разработки c профилем `dockerdb`. Для этого необходимо использовать опцию `-Dspring.profiles.active=dockerdb`. В Intellij Idea добавляем эту опцию в `Edit Configurations -> ChatroomApplication -> Program Arguments`

## Git conventions

При разработке пушить в ветку `master` напрямую запрещается. Каждую фичу следует разрабатывать в своей ветке. Слова в названиях веток разделяются дефисами ("`-`")

Для названий веток используется следующие шаблоны:
- `feature/<branch_name>` - ветка с фичей. Пример: `feature/sign-up` (реализация фичи с регистрацией пользователя)
- `bugfix/<branch_name>` - ветка с исправлением бага. Пример: `bugfix/user-authentication-error` (ветка с изменениями, исправляющими баг с аутентификацией пользователя)

Commit message стоит писать на английском языке

## Coverage conventions

Для сохранения возможности рефакторинга кода и документирования задан нижний порог для покрытия кода тестами в **80%**. Для контроля покрытия тестами используется maven плагин **JaCoCo**. Процент покрытия кода контролируется при каждой сборке проекта. В случае, если фактический процент покрытия ниже, чем требуемый, процесс компиляции завершиться с соответствующей ошибкой.

Для просмотра деталей покрытия кода можно использовать скрипт `open-jacoco-report` в папке `scripts`. Для просмотра детального отчета по покрытию кода тестами:
1. Собрать проект `./mvnw clean package`
2. Создать и открыть отчет `./scripts/open-jacoco-report`
